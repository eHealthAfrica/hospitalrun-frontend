language: node_js
node_js:
- '4'
sudo: false
cache: directories - $HOME/.npm - $HOME/.cache
before_install:
- npm config set spin false
- npm install -g bower
- npm install -g ember
- bower --version
- npm install phantomjs-prebuilt
- node_modules/phantomjs-prebuilt/bin/phantomjs --version
install:
- npm install
- bower install
script:
- npm test
deploy:
  - npm run ci-publish
  on:
    tags: true
    repo: eHealthAfrica/hospitalrun-frontend
    branch: develop
  on:
    tags: true
    repo: eHealthAfrica/hospitalrun-frontend
    branch: stage
  on:
    tags: true
    repo: eHealthAfrica/hospitalrun-frontend
    branch: master
  on:
    tags: true
    repo: eHealthAfrica/hospitalrun-frontend
    branch: eHA/Polyclinic

after_deploy:
  - script/server_build.sh
